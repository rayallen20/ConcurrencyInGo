# Concurrency In Go

## 第3章 GO语言并发组件

### GOMAXPROCS控制

在runtime包中,有一个函数为`runtime.GOMAXPROCS()`.该函数的入参为一个`int`.

**这个函数的函数名有些误导人.人们经常认为这个函数是在设置主机的逻辑处理器可用数量,但实际上这个函数控制的是托管"工作队列"的操作系统线程数量.**此处的"操作系统线程数量"就是之前提到过的"M:N"模型中的N.

**通常来讲,增加或减少工作队列和线程数量都会造成更多的问题.因为GO的调度算法已经在大多数情况下足够好了.**

但什么时候该调整这个值呢?

作者曾经在一个项目上调试,这个项目中有一个受竞态条件影响的组件.他们当时的运行环境有4个逻辑CPU,因此任何一个时间点上,都有4个goroutine同时运行.通过增加GOMAXPROCS以超过逻辑CPU数量的方式,能够更频繁地触发竞态条件,以便能够更快的修好这个bug.

即使你真的发现你的程序在一定数量的工作队列和线程下运行的更好,也还是要谨慎.当你的代码运行在不同的硬件,以及使用了不同版本的GO时,一定要检查这个设置.**调整这个值是以降低抽象层级和性能稳定为代价的.**